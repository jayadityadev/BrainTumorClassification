<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Metrics - Brain Tumor Classifier</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <style>
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .metric-card h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .metric-value {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
        }
        
        .metric-label {
            font-size: 1rem;
            opacity: 0.85;
        }
        
        .chart-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        .class-bar {
            margin: 15px 0;
        }
        
        .class-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .class-bar-fill-container {
            background: #ecf0f1;
            height: 35px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .class-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            padding-left: 15px;
            color: white;
            font-weight: 600;
            transition: width 1s ease;
        }
        
        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .tech-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #4CAF50;
            box-shadow: 0 0 10px #4CAF50;
        }
        
        .status-offline {
            background: #e74c3c;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">üß† Brain Tumor Classifier</div>
            <div class="nav-links">
                <a href="/" class="nav-link">Home</a>
                <a href="/metrics" class="nav-link active">Metrics</a>
                <a href="/#about" class="nav-link">About</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero">
        <div class="container">
            <h1 class="hero-title">üìä System Metrics & Performance</h1>
            <p class="hero-subtitle">Real-time model and dataset statistics</p>
        </div>
    </div>
    
    <div class="container main-content">
        <!-- Model Architecture Details -->
        <div class="card">
            <h2 class="section-title">ü§ñ Model Status</h2>
            <div style="margin: 20px 0;">
                <span class="status-indicator status-online" id="modelStatus"></span>
                <strong>Model Loaded and Ready</strong>
            </div>
            <div style="color: #666; margin-top: 15px;">
                <p id="modelPath">Loading model information...</p>
                <p id="modelArch" style="margin-top: 10px;">Architecture: --</p>
            </div>
            
            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ff9800; margin-top: 20px;">
                <p style="color: #555; margin: 0; font-size: 0.95rem;">
                    <strong>‚ö†Ô∏è Model Scope:</strong> Trained on 3 tumor classes only (Glioma, Meningioma, Pituitary). 
                    Not trained to distinguish tumor vs. no-tumor cases.
                </p>
            </div>
        </div>

        <!-- Image Enhancement Metrics (Module 1) -->
        <div class="card">
            <h2 class="section-title">üî¨ Image Enhancement Metrics (Module 1)</h2>
            <p style="color: #666; margin-bottom: 25px;">Preprocessing pipeline performance and impact on model accuracy</p>
            
            <div class="enhancement-grid">
                <div class="enhancement-card">
                    <div class="enhancement-icon">üßπ</div>
                    <h3 style="font-size: 1.15rem;">Non-local Means Denoising</h3>
                    <div class="enhancement-stats">
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Filter Strength:</span>
                            <span class="stat-value" style="font-size: 0.95rem;">h=10</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Template Window:</span>
                            <span class="stat-value" style="font-size: 0.95rem;">7√ó7 pixels</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Search Window:</span>
                            <span class="stat-value" style="font-size: 0.95rem;">21√ó21 pixels</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Impact:</span>
                            <span class="stat-value-highlight">~3% accuracy gain</span>
                        </div>
                    </div>
                </div>
                
                <div class="enhancement-card">
                    <div class="enhancement-icon">‚ú®</div>
                    <h3 style="font-size: 1.15rem;">CLAHE Enhancement</h3>
                    <div class="enhancement-stats">
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Clip Limit:</span>
                            <span class="stat-value" style="font-size: 0.95rem;">2.0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Grid Size:</span>
                            <span class="stat-value" style="font-size: 0.95rem;">8√ó8 tiles</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Method:</span>
                            <span class="stat-value" style="font-size: 0.95rem; text-align: right">Adaptive Histogram Equalization</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Impact:</span>
                            <span class="stat-value-highlight">~11% accuracy gain</span>
                        </div>
                    </div>
                </div>
                
                <div class="enhancement-card">
                    <div class="enhancement-icon">üìè</div>
                    <h3 style="font-size: 1.15rem;">Normalization</h3>
                    <div class="enhancement-stats">
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Method:</span>
                            <span class="stat-value" style="font-size: 0.95rem;">Min-Max Scaling</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Range:</span>
                            <span class="stat-value" style="font-size: 0.95rem;">[0, 1]</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Color Space:</span>
                            <span class="stat-value" style="font-size: 0.95rem;">RGB (3 channels)</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label" style="font-size: 0.95rem;">Impact:</span>
                            <span class="stat-value-highlight">Essential for convergence</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="enhancement-summary">
                <div class="summary-item">
                    <div class="summary-label">Total Images Enhanced</div>
                    <div class="summary-value">10,087</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Accuracy Without Enhancement</div>
                    <div class="summary-value">~85%</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Accuracy With Enhancement</div>
                    <div class="summary-value">99.21%</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Total Improvement</div>
                    <div class="summary-value improvement">+14.21%</div>
                </div>
            </div>
        </div>

        <!-- Key Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card">
                <h3>üéØ Model Accuracy</h3>
                <div class="metric-value" id="metricAccuracy">--</div>
                <div class="metric-label">Test Set Performance</div>
            </div>
            
            <div class="metric-card" style="background: linear-gradient(135deg, #4CAF50, #45a049);">
                <h3>üìä Training Samples</h3>
                <div class="metric-value" id="metricTrainSamples">--</div>
                <div class="metric-label">Images in Training Set</div>
            </div>
            
            <div class="metric-card" style="background: linear-gradient(135deg, #2196F3, #1976D2);">
                <h3>‚úÖ Test Samples</h3>
                <div class="metric-value" id="metricTestSamples">--</div>
                <div class="metric-label">Images in Test Set</div>
            </div>
            
            <div class="metric-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                <h3>‚ö° Inference Speed</h3>
                <div class="metric-value" id="metricSpeed">--</div>
                <div class="metric-label">Average Processing Time</div>
            </div>
            
            <div class="metric-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                <h3>üî¢ Model Parameters</h3>
                <div class="metric-value" id="metricParams">--</div>
                <div class="metric-label">Trainable Parameters</div>
            </div>
            
            <div class="metric-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                <h3>üñ•Ô∏è GPU Status</h3>
                <div class="metric-value" id="metricGPU">--</div>
                <div class="metric-label">Hardware Acceleration</div>
            </div>
        </div>

        <!-- Class Distribution -->
        <div class="card">
            <h2 class="section-title">üìä Dataset Class Distribution</h2>
            <div class="chart-card">
                <p style="color: #666; margin-bottom: 20px;">
                    Number of samples per tumor class across the combined dataset. Bar width shows relative comparison (scaled to largest class), percentage shows actual proportion of total.
                </p>
                <div id="classDistribution">
                    <div class="class-bar">
                        <div class="class-bar-label">
                            <span>üî¥ Glioma</span>
                            <span id="gliomaCount">--</span>
                        </div>
                        <div class="class-bar-fill-container">
                            <div class="class-bar-fill" id="gliomaBar" style="width: 0%;">0%</div>
                        </div>
                    </div>
                    
                    <div class="class-bar">
                        <div class="class-bar-label">
                            <span>üü° Meningioma</span>
                            <span id="meningiomaCount">--</span>
                        </div>
                        <div class="class-bar-fill-container">
                            <div class="class-bar-fill" id="meningiomaBar" style="width: 0%; background: linear-gradient(90deg, #f39c12, #e67e22);">0%</div>
                        </div>
                    </div>
                    
                    <div class="class-bar">
                        <div class="class-bar-label">
                            <span>üü¢ Pituitary</span>
                            <span id="pituitaryCount">--</span>
                        </div>
                        <div class="class-bar-fill-container">
                            <div class="class-bar-fill" id="pituitaryBar" style="width: 0%; background: linear-gradient(90deg, #4CAF50, #45a049);">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Sources -->
        <div class="card">
            <h2 class="section-title">üìÅ Dataset Sources</h2>
            <div class="chart-card">
                <p style="color: #666; margin-bottom: 20px;">
                    Distribution of samples from different data sources
                </p>
                <div id="sourceDistribution">
                    Loading source information...
                </div>
            </div>
        </div>

        <!-- Deep Learning Metrics (Module 2) -->
        <div class="card">
            <h2 class="section-title">ü§ñ Deep Learning Metrics (Module 2)</h2>
            <p style="color: #666; margin-bottom: 25px;">DenseNet121 architecture and classification performance</p>
            
            <!-- Model Architecture Details -->
            <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); padding: 30px; border-radius: 10px; border-left: 5px solid #9c27b0; margin-bottom: 30px;">
                <h3 style="color: #9c27b0; margin-bottom: 20px; font-size: 1.4rem;">üèóÔ∏è DenseNet121 Architecture (Transfer Learning)</h3>
                <ul style="color: #555; line-height: 2.2; margin-left: 20px; font-size: 1.05rem;">
                    <li><strong>Base Model:</strong> DenseNet121 pre-trained on ImageNet</li>
                    <li><strong>Input Shape:</strong> 128 √ó 128 √ó 3 (RGB Images)</li>
                    <li><strong>Output Classes:</strong> 3 (Glioma, Meningioma, Pituitary)</li>
                    <li><strong>Total Parameters:</strong> 7.3M trainable parameters</li>
                    <li><strong>Training Strategy:</strong> Transfer learning with fine-tuning</li>
                    <li><strong>Preprocessing:</strong> Non-local means denoising + CLAHE + normalization</li>
                    <li><strong>Explainability:</strong> Grad-CAM visualization for tumor localization</li>
                </ul>
            </div>
            
            <!-- Technology Stack -->
            <div style="margin-top: 30px;">
                <h3 style="color: #9c27b0; margin-bottom: 20px; font-size: 1.3rem;">üõ†Ô∏è Technology Stack</h3>
                <div class="tech-stack">
                    <span class="tech-badge" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">TensorFlow 2.x</span>
                    <span class="tech-badge" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">Keras</span>
                    <span class="tech-badge" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">DenseNet121</span>
                    <span class="tech-badge" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">Python 3.11</span>
                    <span class="tech-badge" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">Flask</span>
                    <span class="tech-badge" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">OpenCV</span>
                    <span class="tech-badge" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">NumPy</span>
                    <span class="tech-badge" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">Grad-CAM</span>
                    <span class="tech-badge" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">scikit-learn</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>‚ö†Ô∏è Medical Disclaimer</h3>
                    <p>For research and educational purposes only. Not intended for clinical diagnosis.</p>
                </div>
                <div class="footer-section">
                    <h3>üìä Data Sources</h3>
                    <p>Figshare CE-MRI Dataset ‚Ä¢ Kaggle Brain Tumor MRI Dataset</p>
                </div>
                <div class="footer-section">
                    <h3>üîó Resources</h3>
                    <p><a href="/" style="color: white; text-decoration: underline;">Home</a> ‚Ä¢ 
                       <a href="https://github.com/jayadityadev/BrainTumorClassification" style="color: white; text-decoration: underline;" target="_blank">GitHub</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Brain Tumor Classifier. Built for Medical AI Research.</p>
            </div>
        </div>
    </footer>
    
    <script>
        // Load metrics on page load
        document.addEventListener('DOMContentLoaded', loadAllMetrics);
        
        async function loadAllMetrics() {
            try {
                const response = await fetch('/api/metrics');
                const data = await response.json();
                
                if (data.error) {
                    console.error('Error loading metrics:', data.error);
                    return;
                }
                
                // Model Status
                document.getElementById('modelPath').textContent = `Model: ${data.model.path}`;
                document.getElementById('modelArch').textContent = `Architecture: ${data.model.architecture}`;
                
                if (data.model.status === 'loaded') {
                    document.getElementById('modelStatus').className = 'status-indicator status-online';
                } else {
                    document.getElementById('modelStatus').className = 'status-indicator status-offline';
                }
                
                // Key Metrics
                document.getElementById('metricAccuracy').textContent = data.performance.reported_accuracy;
                document.getElementById('metricTrainSamples').textContent = data.dataset.train_samples.toLocaleString();
                document.getElementById('metricTestSamples').textContent = data.dataset.test_samples.toLocaleString();
                document.getElementById('metricSpeed').textContent = data.performance.avg_inference_time;
                
                if (data.model.total_parameters) {
                    const params = (data.model.total_parameters / 1000000).toFixed(1);
                    document.getElementById('metricParams').textContent = `${params}M`;
                } else {
                    document.getElementById('metricParams').textContent = '7.3M';
                }
                
                document.getElementById('metricGPU').textContent = data.performance.gpu_accelerated ? 'Enabled ‚úì' : 'CPU Only';
                
                // Class Distribution
                if (data.dataset.classes) {
                    const total = data.dataset.total_samples;
                    const classes = data.dataset.classes;
                    
                    // Normalize class names (handle case variations)
                    const glioma = classes.glioma || classes.Glioma || 0;
                    const meningioma = classes.meningioma || classes.Meningioma || 0;
                    const pituitary = classes.pituitary || classes.Pituitary || 0;
                    
                    // Calculate bar width relative to max class count (for visual comparison)
                    const maxCount = Math.max(glioma, meningioma, pituitary);
                    const gliomaPercent = ((glioma / maxCount) * 100).toFixed(1);
                    const meningiomaPercent = ((meningioma / maxCount) * 100).toFixed(1);
                    const pituitaryPercent = ((pituitary / maxCount) * 100).toFixed(1);
                    
                    // Calculate actual percentage of total for display
                    const gliomaOfTotal = ((glioma / total) * 100).toFixed(1);
                    const meningiomaOfTotal = ((meningioma / total) * 100).toFixed(1);
                    const pituitaryOfTotal = ((pituitary / total) * 100).toFixed(1);
                    
                    document.getElementById('gliomaCount').textContent = glioma.toLocaleString();
                    document.getElementById('meningiomaCount').textContent = meningioma.toLocaleString();
                    document.getElementById('pituitaryCount').textContent = pituitary.toLocaleString();
                    
                    // Animate bars (width relative to max for comparison, text shows actual %)
                    setTimeout(() => {
                        document.getElementById('gliomaBar').style.width = gliomaPercent + '%';
                        document.getElementById('gliomaBar').textContent = gliomaOfTotal + '%';
                        
                        document.getElementById('meningiomaBar').style.width = meningiomaPercent + '%';
                        document.getElementById('meningiomaBar').textContent = meningiomaOfTotal + '%';
                        
                        document.getElementById('pituitaryBar').style.width = pituitaryPercent + '%';
                        document.getElementById('pituitaryBar').textContent = pituitaryOfTotal + '%';
                    }, 500);
                }
                
                // Source Distribution
                if (data.dataset.sources) {
                    const sourceDiv = document.getElementById('sourceDistribution');
                    sourceDiv.innerHTML = '';
                    
                    const total = data.dataset.total_samples;
                    
                    Object.entries(data.dataset.sources).forEach(([source, count]) => {
                        const percent = ((count / total) * 100).toFixed(1);
                        const sourceName = source === 'mat' ? 'Figshare CE-MRI' : 'Kaggle Dataset';
                        
                        sourceDiv.innerHTML += `
                            <div class="class-bar">
                                <div class="class-bar-label">
                                    <span>üìÅ ${sourceName}</span>
                                    <span>${count.toLocaleString()} samples</span>
                                </div>
                                <div class="class-bar-fill-container">
                                    <div class="class-bar-fill" style="width: ${percent}%; background: linear-gradient(90deg, #2196F3, #1976D2);">
                                        ${percent}%
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
                
            } catch (error) {
                console.error('Error loading metrics:', error);
            }
        }
    </script>
</body>
</html>
