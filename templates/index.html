<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Tumor Classifier - AI-Powered MRI Analysis</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">üß† Brain Tumor Classifier</div>
            <div class="nav-links">
                <a href="/" class="nav-link active">Home</a>
                <a href="/metrics" class="nav-link">Metrics</a>
                <a href="#about" class="nav-link">About</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section with Live Stats -->
    <div class="hero">
        <div class="container">
            <h1 class="hero-title">AI-Powered Brain Tumor Classification</h1>
            <p class="hero-subtitle">Two-Stage Pipeline: Image Enhancement + Deep Learning Classification</p>
            
            <!-- Module Overview -->
            <div class="module-overview">
                <div class="module-card">
                    <div class="module-icon">üî¨</div>
                    <div class="module-title">Module 1: Image Processing</div>
                    <div class="module-desc">CLAHE Enhancement ‚Ä¢ Denoising ‚Ä¢ Normalization</div>
                </div>
                <div class="pipeline-arrow">‚Üí</div>
                <div class="module-card">
                    <div class="module-icon">ü§ñ</div>
                    <div class="module-title">Module 2: Deep Learning</div>
                    <div class="module-desc">DenseNet121 ‚Ä¢ Transfer Learning ‚Ä¢ Grad-CAM</div>
                </div>
            </div>
            
            <!-- Live Stats Bar -->
            <div class="stats-bar" id="statsBar">
                <div class="stat-item">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="accuracy">--</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <div class="stat-value" id="samples">--</div>
                        <div class="stat-label">Training Samples</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-content">
                        <div class="stat-value" id="speed">--</div>
                        <div class="stat-label">Inference Time</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">üî¨</div>
                    <div class="stat-content">
                        <div class="stat-value" id="classes">3</div>
                        <div class="stat-label">Tumor Classes</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container main-content">
        <!-- Upload Section -->
        <div class="card upload-card">
            <h2 class="section-title">Upload MRI Scan</h2>
            <div class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üì§</div>
                    <div class="upload-text">Click to upload or drag & drop</div>
                    <div class="upload-hint">Supported: PNG, JPG, JPEG, BMP, TIFF (Max 16MB)</div>
                </div>
                <input type="file" id="fileInput" accept="image/*">
            </div>
            
            <div class="preview-section" id="previewSection">
                <h3 class="preview-title">Preview</h3>
                <img id="previewImage" class="preview-image" alt="Preview">
                <div class="button-group">
                    <button class="btn btn-primary" id="analyzeBtn">
                        <span class="btn-icon">üî¨</span> Analyze MRI Scan
                    </button>
                    <button class="btn btn-secondary" id="cancelBtn">Cancel</button>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <div class="pipeline-progress">
                    <div class="progress-stage active" id="stage1">
                        <div class="stage-icon">üì§</div>
                        <div class="stage-text">Loading MRI Image...</div>
                        <div class="stage-check">‚úì</div>
                    </div>
                    <div class="progress-stage" id="stage2">
                        <div class="stage-icon">üî¨</div>
                        <div class="stage-text">Applying Image Enhancement...</div>
                        <div class="stage-check">‚úì</div>
                    </div>
                    <div class="progress-stage" id="stage3">
                        <div class="stage-icon">ü§ñ</div>
                        <div class="stage-text">Running Neural Network...</div>
                        <div class="stage-check">‚úì</div>
                    </div>
                    <div class="progress-stage" id="stage4">
                        <div class="stage-icon">üìä</div>
                        <div class="stage-text">Generating Results...</div>
                        <div class="stage-check">‚úì</div>
                    </div>
                </div>
            </div>
            
            <div class="error" id="errorMsg"></div>
        </div>
        
        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <div class="card result-card-main">
                <!-- Diagnosis Card -->
                <div class="diagnosis-card" id="diagnosisCard">
                    <div class="diagnosis-header">
                        <h2 class="diagnosis-title" id="resultTitle">Diagnosis: Loading...</h2>
                        <div class="diagnosis-badge" id="diagnosisBadge">Analyzing...</div>
                    </div>
                    
                    <div class="confidence-section">
                        <div class="confidence-label">
                            <span>Confidence Level</span>
                            <span id="confidencePercent">0%</span>
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="confidenceFill"></div>
                        </div>
                    </div>
                    
                    <div id="highlightInfo" class="highlight-info"></div>
                    
                    <!-- All Class Probabilities -->
                    <div class="probabilities-section">
                        <h3 class="probabilities-title">Class Probabilities</h3>
                        <div class="probabilities-grid" id="probabilities"></div>
                    </div>
                </div>
                
                <!-- Visualization Card -->
                <div class="visualization-card">
                    <h3 class="visualization-title">AI Analysis Visualization</h3>
                    <img id="visualizationImage" class="visualization-image" alt="Grad-CAM Visualization">
                    <div class="visualization-legend">
                        <div class="legend-item">
                            <span class="legend-box" style="background: #4CAF50;"></span>
                            <span>Original MRI</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-box" style="background: #2196F3;"></span>
                            <span>Enhanced (CLAHE)</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-box" style="background: linear-gradient(90deg, #FF0000, #FFFF00);"></span>
                            <span>Grad-CAM Heatmap</span>
                        </div>
                    </div>
                    <p class="visualization-note">
                        <strong>Grad-CAM</strong> highlights regions that influenced the AI's decision, 
                        showing where potential tumor tissue is detected.
                    </p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary btn-large" id="newAnalysisBtn">
                        <span class="btn-icon">üîÑ</span> Analyze Another Image
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Pipeline Demonstration Section -->
        <div class="card">
            <h2 class="section-title" style="color: var(--dark);">üîÑ Complete Processing Pipeline</h2>
            <p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 1.05rem;">End-to-end workflow from raw MRI to classified diagnosis</p>
            
            <div class="pipeline-vertical">
                <!-- Step 1: Input -->
                <div class="pipeline-module">
                    <div class="module-number">1</div>
                    <div class="module-content neutral">
                        <div class="module-icon-large">üì§</div>
                        <h3 class="module-heading">Input MRI Scan</h3>
                        <p class="module-description">Patient uploads raw brain MRI scan for analysis</p>
                    </div>
                </div>
                
                <div class="pipeline-divider">
                    <div class="divider-line"></div>
                    <div class="divider-arrow">‚Üì</div>
                </div>
                
                <!-- Step 2: Module 1 -->
                <div class="pipeline-module">
                    <div class="module-number blue">2</div>
                    <div class="module-content blue">
                        <div class="module-header">
                            <div class="module-icon-large">üî¨</div>
                            <div>
                                <h3 class="module-heading">Module 1: Image Enhancement</h3>
                                <p class="module-subtitle">Preprocessing & Quality Improvement</p>
                            </div>
                        </div>
                        <div class="module-techniques">
                            <div class="technique-item">
                                <span class="technique-badge blue">üßπ Denoising</span>
                                <span class="technique-desc">Non-local means filter</span>
                            </div>
                            <div class="technique-item">
                                <span class="technique-badge blue">‚ú® CLAHE</span>
                                <span class="technique-desc">Contrast enhancement</span>
                            </div>
                            <div class="technique-item">
                                <span class="technique-badge blue">üìè Normalization</span>
                                <span class="technique-desc">Pixel value scaling</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="pipeline-divider">
                    <div class="divider-line"></div>
                    <div class="divider-arrow">‚Üì</div>
                </div>
                
                <!-- Step 3: Module 2 -->
                <div class="pipeline-module">
                    <div class="module-number purple">3</div>
                    <div class="module-content purple">
                        <div class="module-header">
                            <div class="module-icon-large">ü§ñ</div>
                            <div>
                                <h3 class="module-heading">Module 2: Deep Learning</h3>
                                <p class="module-subtitle">Classification & Explainability</p>
                            </div>
                        </div>
                        <div class="module-techniques">
                            <div class="technique-item">
                                <span class="technique-badge purple">üß† DenseNet121</span>
                                <span class="technique-desc">Transfer learning model</span>
                            </div>
                            <div class="technique-item">
                                <span class="technique-badge purple">üéØ Softmax</span>
                                <span class="technique-desc">Probability distribution</span>
                            </div>
                            <div class="technique-item">
                                <span class="technique-badge purple">üî• Grad-CAM</span>
                                <span class="technique-desc">Visual explanation heatmap</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="pipeline-divider">
                    <div class="divider-line"></div>
                    <div class="divider-arrow">‚Üì</div>
                </div>
                
                <!-- Step 4: Output -->
                <div class="pipeline-module">
                    <div class="module-number">4</div>
                    <div class="module-content neutral">
                        <div class="module-icon-large">üìä</div>
                        <h3 class="module-heading">Classification Results</h3>
                        <p class="module-description">Tumor type prediction with confidence scores and localization heatmap</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Module Details Section -->
        <div class="modules-section">
            <!-- Module 1 -->
            <div class="card module-card-detailed">
                <div class="module-header">
                    <div class="module-badge module-1-badge">Module 1</div>
                    <h2>üî¨ Image Processing & Enhancement</h2>
                </div>
                <p class="module-intro">Preprocessing pipeline that enhances MRI scan quality before classification</p>
                
                <div class="technique-grid">
                    <div class="technique-card">
                        <div class="technique-icon">üßπ</div>
                        <h4>Non-local Means Denoising</h4>
                        <p><strong>Purpose:</strong> Removes noise artifacts from MRI scans while preserving important structural edges and details</p>
                        <p><strong>Impact:</strong> Cleaner images lead to better feature extraction</p>
                    </div>
                    
                    <div class="technique-card">
                        <div class="technique-icon">‚ú®</div>
                        <h4>CLAHE Enhancement</h4>
                        <p><strong>Purpose:</strong> Contrast Limited Adaptive Histogram Equalization improves local contrast</p>
                        <p><strong>Impact:</strong> Critical for accuracy - 99.21% with enhancement vs ~85% without</p>
                    </div>
                    
                    <div class="technique-card">
                        <div class="technique-icon">üìè</div>
                        <h4>Normalization</h4>
                        <p><strong>Purpose:</strong> Standardizes pixel intensity values to [0, 1] range</p>
                        <p><strong>Impact:</strong> Ensures consistent input for neural network training</p>
                    </div>
                </div>
                
                <div class="module-stats">
                    <div class="stat-item-small">
                        <strong>~10,087</strong>
                        <span>Images Enhanced</span>
                    </div>
                    <div class="stat-item-small">
                        <strong>+14%</strong>
                        <span>Accuracy Improvement</span>
                    </div>
                    <div class="stat-item-small">
                        <strong>128√ó128</strong>
                        <span>Output Resolution</span>
                    </div>
                </div>
            </div>
            
            <!-- Module 2 -->
            <div class="card module-card-detailed">
                <div class="module-header">
                    <div class="module-badge module-2-badge">Module 2</div>
                    <h2>ü§ñ Deep Learning Classification</h2>
                </div>
                <p class="module-intro">Transfer learning with DenseNet121 for accurate tumor classification</p>
                
                <div class="technique-grid">
                    <div class="technique-card">
                        <div class="technique-icon">üß†</div>
                        <h4>DenseNet121 Architecture</h4>
                        <p><strong>Base Model:</strong> Pre-trained on ImageNet with 7.3M parameters</p>
                        <p><strong>Strategy:</strong> Transfer learning with fine-tuning on brain MRI data</p>
                    </div>
                    
                    <div class="technique-card">
                        <div class="technique-icon">üéØ</div>
                        <h4>3-Class Classification</h4>
                        <p><strong>Classes:</strong> Glioma, Meningioma, Pituitary tumors</p>
                        <p><strong>Output:</strong> Softmax probability distribution with confidence scores</p>
                    </div>
                    
                    <div class="technique-card">
                        <div class="technique-icon">üîç</div>
                        <h4>Grad-CAM Explainability</h4>
                        <p><strong>Purpose:</strong> Visualizes which regions influenced the classification decision</p>
                        <p><strong>Impact:</strong> Makes AI transparent and trustworthy for medical use</p>
                    </div>
                </div>
                
                <div class="module-stats">
                    <div class="stat-item-small">
                        <strong>99.21%</strong>
                        <span>Test Accuracy</span>
                    </div>
                    <div class="stat-item-small">
                        <strong>8,087</strong>
                        <span>Training Samples</span>
                    </div>
                    <div class="stat-item-small">
                        <strong>~51ms</strong>
                        <span>Inference Time</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- About Section -->
        <div class="about-section" id="about">
            <div class="card">
                <h2 class="section-title">About This System</h2>
                <div class="about-content">
                    <p>
                        This AI-powered system classifies brain MRI scans into three tumor categories:
                        <strong>Glioma</strong>, <strong>Meningioma</strong>, and <strong>Pituitary tumors</strong>.
                    </p>
                    <p>
                        Built with <strong>TensorFlow</strong> and <strong>DenseNet121</strong> transfer learning,
                        enhanced with Grad-CAM explainability for transparent medical AI.
                    </p>
                    <div style="background: linear-gradient(135deg, #fff3cd, #fff8e1); padding: 20px; border-radius: 10px; border-left: 4px solid #ff9800; margin: 20px 0;">
                        <h4 style="color: #f57c00; margin-bottom: 10px;">‚ö†Ô∏è Important Scope Limitation</h4>
                        <p style="color: #555; margin-bottom: 10px;">
                            <strong>This model is trained exclusively on tumor-positive MRI scans</strong> (Glioma, Meningioma, Pituitary). 
                            It is designed to <strong>differentiate between tumor types</strong>, not to detect tumor presence vs. absence.
                        </p>
                        <p style="color: #555; margin: 0;">
                            <strong>Expected behavior:</strong> If a "No Tumor" MRI is provided, the model will classify it as one of the three tumor types 
                            (since that's all it was trained on). For production use, a separate tumor detection model should precede this classifier.
                        </p>
                    </div>
                    <div class="tumor-types">
                        <div class="tumor-type">
                            <h4>üî¥ Glioma</h4>
                            <p>Aggressive tumor originating in brain glial cells. Requires urgent treatment and monitoring.</p>
                        </div>
                        <div class="tumor-type">
                            <h4>üü° Meningioma</h4>
                            <p>Most common brain tumor, usually benign. Forms in meninges (brain protective layers).</p>
                        </div>
                        <div class="tumor-type">
                            <h4>üü¢ Pituitary</h4>
                            <p>Tumor in pituitary gland affecting hormone regulation. Often treatable with medication or surgery.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>‚ö†Ô∏è Medical Disclaimer</h3>
                    <p>For research and educational purposes only. Not intended for clinical diagnosis. 
                       Always consult qualified medical professionals.</p>
                </div>
                <div class="footer-section">
                    <h3>üî¨ Technology</h3>
                    <p>TensorFlow ‚Ä¢ Keras ‚Ä¢ DenseNet121 ‚Ä¢ Grad-CAM ‚Ä¢ Flask</p>
                </div>
                <div class="footer-section">
                    <h3>üìä Model Info</h3>
                    <p>Training: 6,568 samples ‚Ä¢ Test: 1,519 samples ‚Ä¢ Accuracy: 99.21%</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Brain Tumor Classifier. Built for Medical AI Research.</p>
            </div>
        </div>
    </footer>
    
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
